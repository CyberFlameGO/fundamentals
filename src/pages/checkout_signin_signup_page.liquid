{% comment %}
  This is the signin/signup page that preceeds the checkout page.
  Specifically, this is the page where a user can either sign in or sign up
  as a part of the purchase process. It preceeds the step where the user
  enters his or her credit card details.
  Note that you cannot edit the actual form, however the surrounding content
  of the page may be modified.
{% endcomment %}

<main class="checkout" id="main-content" role="main">
  <div class="container">
    <div class="row">
      <article class="checkout__form">
        <ul class="progress-bar">
          <li class="active">{{ 'checkouts.new.list_item_1' | translate }}</li>
          <li>{{ 'checkouts.new.list_item_2' | translate }}</li>
        </ul>
        <section class="checkout__form--sign-in">
          <h1 class="page__heading">{{ 'liquid.views.sign_in_page.header_welcome_back' | translate }}</h1>
          <aside class="checkout__sign-up">
            <a id="button__sign-up" href="#">{{ 'liquid.views.sign_in_page.link_create_account' | translate }}</a>
          </aside>
          {% include 'remote_sign_in' %}
          {% form 'checkout_sign_in' %}
          {% if errors.size > 0 %}
            {% include 'form_errors' %}
          {% endif %}
          <div class="form__group">
            {% assign field = fields.email %}
            <label for="{{ field.name }}" class="form__label">{{ field.label }}
              <input type="email" id="{{ field.name }}" name="{{ field.name }}" value="{{ field.value }}" placeholder="{{ field.placeholder }}" autocapitalize="off" autocomplete="off" autocorrect="off" spellcheck="false" {% if field.required %}required{% endif %} autofocus class="form__control" />
            </label>
          </div>
          <div class="form__group">
            {% assign field = fields.password %}
            <label for="user[sign-in][email]" class="form__label">{{ field.label }}
              <input type="password" id="user[sign-in][email]" name="{{ field.name }}" placeholder="{{ field.placeholder }}" autocapitalize="off" autocomplete="off" autocorrect="off" spellcheck="false" {% if field.required %}required{% endif %} class="form__control" />
            </label>
          </div>
          <div class="form__group form__remember-me">
            {% assign field = fields.remember_me %}
            {% comment %}
              This hidden input is necessary so that things behave correctly when the checkbox is left unticked.
            {% endcomment %}
            <label for="{{ field.name }}">
              <input type="hidden" name="{{ field.name }}" value="0" />
              <input type="checkbox" id="{{ field.name }}" name="{{ field.name }}" value="{{ field.value }}" />
              {{ field.label }}
            </label>
            <a href="{{ page.forgot_password_url }}" class="form__forgot-password">{{ 'liquid.views.sign_in_page.forgot_password' | translate }}</a>
          </div>
          <div class="form__group">
            <input type="submit" value="{{ fields.submit.label }}" class="button button-primary" id="signin" />
          </div>
          {% endform %}
        </section>
        <section class="checkout__form--sign-up">
          <h1 class="page__heading">{{ 'liquid.views.sign_up_page.header_create_account' | translate }}</h1>
          <aside class="checkout__sign-in">
            <a id="button__sign-in" href="#">{{ 'liquid.views.sign_up_page.link_sign_in' | translate }}</a>
          </aside>
          {% include 'remote_sign_in' %}
          {% form 'checkout_sign_up' %}
          {% if errors.size > 0 %}
            {% include 'form_errors' %}
          {% endif %}
          <div class="form__group">
            {% assign field = fields.first_name %}
            <label for="{{ field.name }}" class="form__label">{{ field.label }}
              <input type="text" id="{{ field.name }}" name="{{ field.name }}" value="{{ field.value }}" placeholder="{{ field.placeholder }}" {% if field.required %}required{% endif %} autocapitalize="off" autocomplete="off" autocorrect="off" spellcheck="false" autofocus class="form__control" />
            </label>
            {% assign field = fields.last_name %}
            <label for="{{ field.name }}" class="form__label">{{ field.label }}
              <input type="text" id="{{ field.name }}" name="{{ field.name }}" value="{{ field.value }}" placeholder="{{ field.placeholder }}" {% if field.required %}required{% endif %} autocapitalize="off" autocomplete="off" autocorrect="off" spellcheck="false" class="form__control" />
            </label>
          </div>
          {% assign field = fields.email %}
          <div class="form__group">
            <label for="user[sign-up][email]" class="form__label">{{ field.label }}
              <input type="email" id="user[sign-up][email]" name="{{ field.name }}" value="{{ field.value }}" placeholder="{{ field.placeholder }}" {% if field.required %}required{% endif %} autocapitalize="off" autocomplete="off" autocorrect="off" spellcheck="false" class="form__control" />
            </label>
          </div>
          {% assign field = fields.password %}
          <div class="form__group">
            <label for="{{ field.name }}" class="form__label">{{ field.label }}
              <input type="password" id="{{ field.name }}" name="{{ field.name }}" placeholder="{{ field.placeholder }}" {% if field.required %}required{% endif %} autocapitalize="off" autocomplete="off" autocorrect="off" spellcheck="false" class="form__control" />
            </label>
          </div>
          {% for field in custom_signup_fields %}
            <div class="form__group">
              {{ field.hidden_input }}
              <label for="{{ field.name }}" class="form__label">{{ field.label }}
                {% if field.type_is_country %}
                  <select id="{{ field.name }}" name="{{ field.name }}" {% if field.required %}required{% endif %} class="form__control">
                    {{ field.country_options }}
                  </select>
                {% else %}
                  <input type="text" id="{{ field.name }}" name="{{ field.name }}" value="{{ field.value }}" placeholder="{{ field.label }}" {% if field.required %}required{% endif %} class="form__control" >
                {% endif %}
              </label>
            </div>
          {% endfor %}
          {% if fields.terms != blank %}
            {% assign field = fields.terms %}
            <div class="form__group">
              <label for="sign_up_terms">
                {% comment %}
                  This hidden input is necessary so that things behave correctly when the checkbox is left unticked.
                {% endcomment %}
                <input type="hidden" name="{{ field.name }}" value="0" />
                <input type="checkbox" id="{{ field.name }}" name="{{ field.name }}" value="{{ field.value }}" required class="form__control" />
                {{ field.label }}
              </label>
            </div>
          {% endif %}
          <div class="form__group">
            <input type="submit" value="{{ fields.submit.label }}" class="button button-primary" id="signup" />
          </div>
          {% endform %}
        </section>
      </article>
      <aside class="checkout__product-overview">
        <img src="{{ page.product.card_image_url }}" alt="{{ page.product.name }}" title="{{ page.product.name }}" class="img-responsive" />
        <h3>{{ page.checkout_description }}</h3>
      </aside>
    </div>
  </div>
</main>

<script type="text/javascript">
  (function ($) {

    $('input:text:visible:first').focus();

    $buttonSignIn = $('#button__sign-in');
    $buttonSignUp = $('#button__sign-up');
    $formSignIn = $('.checkout__form--sign-in');
    $formSignUp = $('.checkout__form--sign-up');

    if ('{{ page.active_tab }}' === 'signin') {
      hide($formSignIn);
    } else {
      hide($formSignUp);
    }

    function hide($container) {
      $container.hide();
      return true;
    }
    function show($container) {
      $container.show();
      return true;
    }

    $buttonSignIn.click(function (e) {
      // display sign in container
      e.preventDefault();
      hide($formSignUp);
      show($formSignIn);
      $('input:visible:first').focus();
    })

    $buttonSignUp.click(function (e) {
      // display sign in container
      e.preventDefault();
      hide($formSignIn);
      show($formSignUp);
      $('input:visible:first').focus();
    })

  })(jQuery)
</script>
